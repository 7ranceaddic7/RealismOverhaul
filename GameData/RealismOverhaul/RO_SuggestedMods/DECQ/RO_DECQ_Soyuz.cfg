//  ==================================================
//  Sources:

//  Soyuz TMA - NASA:                               https://www.nasa.gov/externalflash/ISSRG/pdfs/soyuz.pdf
//  Soyuz TMA - ESA:                                http://wsn.spaceflight.esa.int/docs/Factsheets/35%20Soyuz%20LR.pdf
//  Soyuz Spacecraft - Rocket and Space Technology: http://www.braeunig.us/space/specs/soyuz.htm
//  Soyuz Spacecraft - University of Houston:       http://viking.coe.uh.edu/~gkitmacher/_content/spacecraft/Capsules%20Historic%20folder/soyuz.pdf

//  ==================================================
//  Soyuz TM/TMA/MS docking system.

//  Dimensions: - m
//  Inert Mass: 250 Kg
//  ==================================================

@PART[SOYUZdockingPort]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @title = Soyuz TM/TMA/MS Docking System
    %manufacturer - N/A
    @description = The Soyuz docking system is the male part of a probe and drogue system. It's equipped with an antenna and the soft-docking system. To use the docking system first extend the probe and then dock the two spacecraft. The probe will prevent them from connecting so that the Soyuz spacecraft can be rotated precisely to the desired position. Once that is done the probe is retracted, allowing hard docking to take place.

    @mass = 0.25
    @crashTolerance = 14
    %breakingForce = 250
    %breakingTorque = 250
    @maxTemp = 473.15
    %skinMaxTemp = 473.15
    @bulkheadProfiles = srf, size2
    !specPower = NULL

    @MODULE[ModuleDockingNode]
    {
        @nodeType = SSVP
        %gendered = True
        %genderedFemale = False
        %acquireForce = 0.5
        %acquireMinFwdDot = 0.8
        %acquireminRollDot = -3.40282347E+38
        %acquireRange = 0.25
        %acquireTorque = 0.5
        %captureMaxRvel = 0.1
        %captureMinFwdDot = 0.998
        %captureMinRollDot = -3.40282347E+38
        %captureRange = 0.05
        %minDistanceToReEngage = 0.25
        %undockEjectionForce = 0.1
        @stagingEnabled = False
    }

    @MODULE[ModuleAnimateGeneric]:HAS[#animationName[OPEN_ANTENNA]]
    {
        %isOneShot = False
        %allowManualControl = True
        @startEventGUIName = Deploy Antenna
        @endEventGUIName = Stow Antenna
        @actionGUIName = Toggle Antenna
    }

    @MODULE[ModuleAnimateGeneric]:HAS[#animationName[DOCKING_PORT]]
    {
        %isOneShot = False
        %allowManualControl = True
        @startEventGUIName = Extend Probe
        @endEventGUIName = Retract Probe
        @actionGUIName = Toggle Probe
        %allowAnimationWhileShielded = False
    }
}

//  ==================================================
//  Soyuz TM/TMA/MS Orbital Module.

//  Dimensions: - m
//  Gross Mass: 1050 Kg

//  The inert mass value does not include the mass of
//  the docking system (250 Kg).
//  ==================================================

@PART[SOYUZ_orbitalSegment]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @title = Soyuz TM/TMA/MS Orbital Module
    %manufacturer = N/A
    @description = The Orbital Module of the Soyuz contains everything that it is not needed for reentry. This includes the docking system, the airlock and the KURS automatic docking antennas. It is jettisoned before entering the atmosphere.

    @mass = 1.05
    @crashTolerance = 10
    %breakingForce = 250
    %breakingTorque = 250
    @maxTemp = 673.15
    %skinMaxTemp = 673.15
    !bulkheadProfiles,* = NULL
    %bulkheadProfiles = size2, srf
    !vesselType = NULL
    !CrewCapacity = NULL
    %stagingIcon = DECOUPLER_HOR
    !specPower = NULL

    !MODULE[ModuleCommand]{}

    @MODULE[ModuleDecouple]
    {
        @ejectionForce = 10
        %stagingEnabled = False
        %stagingEnableText = Orbital Module Not Staged
        %stagingDisableText = Orbital Module Staged
    }

    @MODULE[ModuleAnimateGeneric]
    {
        %isOneShot = False
        %allowManualControl = True
        @startEventGUIName = Deploy KURS Antennae
        @endEventGUIName = Retract KURS Antennae
        @actionGUIName = Toggle KURS Antennae
        %allowAnimationWhileShielded = False
    }

    @MODULE[ModuleLight]
    {
        @resourceAmount = 0.05
    }

    !MODULE[TRReflection],*{}

    !RESOURCE,*{}
}

//  ==================================================
//  Soyuz TM/TMA/MS Orbital Module.

//  Connected Living Space compatibility.
//  ==================================================

@PART[SOYUZ_orbitalSegment]:FOR[RealismOverhaul]:NEEDS[ConnectedLivingSpace]
{
    !MODULE[ModuleConnectedLivingSpace].*{}

    MODULE
    {
        name = ModuleConnectedLivingSpace
        passable = True
    }
}

//  ==================================================
//  Soyuz TM/TMA/MS Orbital Module.

//  TAC Life Support compatibility.
//  ==================================================

@PART[SOYUZ_orbitalSegment]:FOR[RealismOverhaul]:NEEDS[TacLifeSupport]
{
    @description ^= :$: Provides support resources for a crew of 3 for up to 4 days.

    @mass -= 0.072

    MODULE
    {
        name = ModuleFuelTanks
        type = ServiceModule
        volume = 230
        basemass = -1

        TANK
        {
            name = Food
            amount = 61.5
            maxAmount = 61.5
        }

        TANK
        {
            name = Water
            amount = 42
            maxAmount = 42
        }

        TANK
        {
            name = Oxygen
            amount = 6480
            maxAmount = 6480
        }

        TANK
        {
            name = Waste
            amount = 0
            maxAmount = 6.4
        }

        TANK
        {
            name = WasteWater
            amount = 0
            maxAmount = 52.5
        }

        TANK
        {
            name = CarbonDioxide
            amount = 0
            maxAmount = 5425
        }
    }
}

//  ==================================================
//  Soyuz TM/TMA/MS Orbital Module.

//  Texture Replacer compatibility.
//  ==================================================

@PART[SOYUZ_orbitalSegment]:FOR[RealismOverhaul]:NEEDS[TextureReplacer]
{
    MODULE
    {
        name = TRReflection
        shader = Reflective/Bumped Diffuse
        meshes = Cylinder_010
        colour = 0.9 0.9 0.9
        interval = 2.0
    }
}

//  ==================================================
//  Soyuz TM/TMA/MS Orbital Module.

//  Default pack cleanup.
//  ==================================================

@PART[SOYUZ_orbitalSegment]:FOR[zzzRealismOverhaul]
{
    !MODULE[MechJebCore],*{}

    !RESOURCE,*{}
}

//  ==================================================
//  Soyuz TM/TMA/MS Descent Module.

//  Dimensions: - m
//  Gross Mass: 2560 Kg

//  The inert mass value does not include the mass of
//  the heat shield (340 Kg).
//  ==================================================

@PART[SOYUZ_REENTRY_CAPSULE]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @title = Soyuz TM/TMA/MS Descent Module
    %manufacturer = N/A
    @description = Soyuz Descent Module is where the crew sits during both ascent and reentry. It's equipped with basic life support, RCS for control during reentry and landing engines for softening the landing. Another notable feature is the offset COM, which allows the pod to generate lifting force during reentry and allow a small degree of control over it's landing zone.

    @mass = 2.52
    @crashTolerance = 12
    %breakingForce = 250
    %breakingTorque = 250
    @maxTemp = 773.15
    %skinMaxTemp = 773.15
    //CoPOffset = 0, 0.4, 0.0
    //CoMOffset = 0, -0.05, 0.04
    !specPower = NULL

    @INTERNAL
    {
        %scaleAll = 1.0, 1.0, 1.0

        @MODULE[InternalSeat],*
        {
            %kerbalScale = 1.0, 1.0, 1.0
            %kerbalOffset = 0.0, 0.0, 0.0
            %kerbalEyeOffset = 0.0, 0.0, 0.0
        }
    }

    @MODULE[ModuleCommand]
    {
        @minimumCrew = 1

        //  Simulate the avionics and life support systems electrical requirements.

        RESOURCE
        {
            name = ElectricCharge
            rate = 0.4
        }
    }

    !MODULE[ModuleReactionWheel]{}

    @MODULE[ModuleScienceContainer]
    {
        @storageRange = 3.125
    }

    @MODULE[ModuleEngines*]
    {
        @name = ModuleEnginesRF
        //thrustVectorTransformName = thrustTransform
        @minThrust = 0
        @maxThrust = 60
        @heatProduction = 100
        @useEngineResponseTime = False
        @engineAccelerationSpeed = 0
        //fxOffset = 0, 0, 0.35

        @PROPELLANT[SolidFuel]
        {
            @name = HTPB
        }

        @atmosphereCurve
        {
            @key,0 = 0 250
            @key,1 = 1 230
        }
    }

    @MODULE[ModuleRCS]
    {
        //  Two 147 N High Test Peroxide (HTP) thrusters per axis.

        @thrusterPower = 0.294
        !enableX = NULL
        !enableY = NULL
        !enableZ = NULL
        !fxPrefix = NULL
        !resourceName = NULL

        PROPELLANT
        {
            name = HTP
            ratio = 1.0
        }

        @atmosphereCurve
        {
            @key,0 = 0 290
            @key,1 = 1 144
        }
    }

    !MODULE[ModuleAblator]{}

    !MODULE[TRReflection],*{}

    !MODULE[ModuleFuelTanks]{}

    MODULE
    {
        name = CoMShifter
        DescentModeCoM = 0.0, 0.0, -0.1
    }

    MODULE
    {
        name = ModuleFuelTanks
        type = ServiceModule
        volume = 50
        basemass = -1

        TANK
        {
            name = ElectricCharge
            amount = 21600
            maxAmount = 21600
        }

        TANK
        {
            name = HTP
            amount = 28
            maxAmount = 28
        }
    }

    !RESOURCE,*{}
}

//  ==================================================
//  Soyuz TM/TMA/MS Descent Module.

//  Remote Tech compatibility.
//  ==================================================

@PART[SOYUZ_REENTRY_CAPSULE]:FOR[RealismOverhaul]:NEEDS[RemoteTech]
{
    !MODULE[ModuleRTAntenna*]{}

    !MODULE[ModuleSPU*]{}

    MODULE
    {
        name = ModuleRTAntenna
        isRTActive = True
        Mode0OmniRange = 0
        Mode1OmniRange = 100000
        EnergyCost = 0.025

        TRANSMITTER
        {
            PacketInterval = 1.0
            PacketSize = 0.512
            PacketResourceCost = 0.025
        }
    }
}

//  ==================================================
//  Soyuz TM/TMA/MS Descent Module.

//  TAC Life Support compatibility.
//  ==================================================

@PART[SOYUZ_REENTRY_CAPSULE]:FOR[RealismOverhaul]:NEEDS[TacLifeSupport]
{
    @description ^= :$: Supports a crew of 3 for up to 12 hours.

    @mass -= 0.009

    @MODULE[ModuleFuelTanks]
    {
        @volume = 90

        TANK
        {
            name = Food
            amount = 8.8
            maxAmount = 8.8
        }

        TANK
        {
            name = Water
            amount = 6
            maxAmount = 6
        }

        TANK
        {
            name = Oxygen
            amount = 900
            maxAmount = 900
        }

        TANK
        {
            name = Waste
            amount = 0
            maxAmount = 0.8
        }

        TANK
        {
            name = WasteWater
            amount = 0
            maxAmount = 7.5
        }

        TANK
        {
            name = CarbonDioxide
            amount = 0
            maxAmount = 775
        }
    }
}

//  ==================================================
//  Soyuz TM/TMA/MS Descent Module.

//  Texture Replacer compatibility.
//  ==================================================

@PART[SOYUZ_REENTRY_CAPSULE]:FOR[RealismOverhaul]:NEEDS[TextureReplacer]
{
    MODULE
    {
        name = TRReflection
        shader = Reflective/Bumped Diffuse
        meshes = Cylinder_033
        colour = 0.9 0.9 0.9
        interval = 2.0
    }
}

//  ==================================================
//  Soyuz TM/TMA/MS Descent Module.

//  Default pack cleanup.
//  ==================================================

@PART[SOYUZ_REENTRY_CAPSULE]:FOR[zzzRealismOverhaul]
{
    !MODULE[ModuleResourceConverter],*{}

    !MODULE[MechJebCore],*{}

    !RESOURCE,*{}
}

//  ==================================================
//  Soyuz TM/TMA/MS Descent Module heat shield.

//  Dimensions: - m
//  Gross Mass: 340 Kg
//  ==================================================

@PART[SOYUZ_HEAT_SHIELD]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    specPower = 500.1

    CoPOffset = 0, 0.1, 0.0

    @category = Aero
    @title = Soyuz TM/TMA/MS Heatshield
    %manufacturer = N/A
    @description = The heat shield for the Soyuz TM/TMA/MS Descent Module. Jettisoned after parachute deployment.

    @mass = 0.07
    @crashTolerance = 16
    %breakingForce = 250
    %breakingTorque = 250
    @maxTemp = 2473.15
    %skinMaxTemp = 3773.15
    %skinMassPerArea = 4
    %emissiveConstant = 0.6
    %stageOffset = 1
    %childStageOffset = 1
    %stagingIcon = DECOUPLER_HOR
    @bulkheadProfiles = srf, size2

    @MODULE[ModuleDecouple]
    {
        @ejectionForce = 10
        %isOmniDecoupler = True
        %menuName = Jettison Heat Shield
        %stagingEnabled = False
        %stagingEnableText = HS Jettison Not Staged
        %stagingDisableText = HS Jettison Staged
    }

    @MODULE[ModuleAblator]
    {
        %outputResource = CharredAblator
        %outputMult = 0.75
        @lossExp = -8000
        @lossConst = 0.1
        @pyrolysisLossFactor = 26000
        %charMax = 1.0
        %charMin = 1.0
    }

    !RESOURCE,*{}

    RESOURCE
    {
        name = Ablator
        amount = 266
        maxAmount = 266
    }

    RESOURCE
    {
        name = CharredAblator
        amount = 0
        maxAmount = 200
    }
}

//  ==================================================
//  Soyuz TM/TMA/MS Service Module decoupler.

//  Dimensions: 2.2 m
//  Inert Mass: 50 Kg
//  ==================================================

@PART[SOYUZ_SEPARATOR]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @title = Soyuz Service Module Decoupler
    %manufacturer = N/A
    @description = The structural truss that connects PAO service module to SA.

    @mass = 0.05
    @crashTolerance = 12
    %breakingForce = 250
    %breakingTorque = 250
    @maxTemp = 473.15
    %skinMaxTemp = 473.15
    %stageOffset = 1
    %childStageOffset = 1
    %stagingIcon = DECOUPLER_HOR
    @bulkheadProfiles = srf, size2
    !specPower = NULL

    @MODULE[ModuleDecouple]
    {
        @ejectionForce = 100
    }
}


//  ==================================================
//  Soyuz TM/TMA/MS solar array.

//  Dimensions: 1.4 m x 4.2 m
//  Inert Mass: 75 Kg
//  ==================================================

@PART[SOYUZ_SOLAR_PANEL]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.135, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @title = Soyuz TM/TMA/MS Solar Array
    %manufacturer = N/A
    @description = A solar array used on modern Soyuz spacecraft variants. Efficient, reliable and lightweight.

    @mass = 0.075
    @crashTolerance = 10
    %breakingForce = 250
    %breakingTorque = 250
    @maxTemp = 473.15
    %skinMaxTemp = 473.15
    !specPower = NULL

    @MODULE[ModuleDeployableSolarPanel]
    {
        @chargeRate = 0.625
    }

    !MODULE[TRReflection],*{}
}

//  ==================================================
//  Soyuz TM/TMA/MS solar array.

//  Texture Replacer compatibility.
//  ==================================================

@PART[SOYUZ_SOLAR_PANEL]:FOR[RealismOverhaul]:NEEDS[TextureReplacer]
{
    MODULE
    {
        name = TRReflection
        shader = Reflective/Bumped Diffuse
        meshes = Cube_053
        colour = 0.3 0.3 0.3
        interval = 2.0
    }

    MODULE
    {
        name = TRReflection
        shader = Reflective/Bumped Diffuse
        meshes = Cube_056
        colour = 0.3 0.3 0.3
        interval = 2.0
    }

    MODULE
    {
        name = TRReflection
        shader = Reflective/Bumped Diffuse
        meshes = Cube_061
        colour = 0.3 0.3 0.3
        interval = 2.0
    }

    MODULE
    {
        name = TRReflection
        shader = Reflective/Bumped Diffuse
        meshes = Cube_064
        colour = 0.3 0.3 0.3
        interval = 2.0
    }
}

//  ==================================================
//  Soyuz TM/TMA/MS Service Module.

//  Dimensions: - m
//  Gross Mass: 2600 Kg
//  ==================================================

@PART[SOYUZ_ENGINE]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @title = Soyuz TM/TMA/MS Instrument & Service Module
    %manufacturer = N/A
    @description = The Soyuz Instrument and Service Module (PAO) contains everything that the Soyuz needs for orbital operations. It is jettisoned just before reentry.

    @mass = 1.51
    @crashTolerance = 10
    %breakingForce = 250
    %breakingTorque = 250
    @maxTemp = 673.15
    %skinMaxTemp = 673.15
    %stageOffset = 1
    %childStageOffset = 1
    %stagingIcon = LIQUID_ENGINE
    @bulkheadProfiles = srf, size2
    @CoMOffset = 0, 0.15, 0.0
    !specPower = NULL

    @MODULE[ModuleAnimateGeneric]
    {
        !stagingEnabled,* = NULL
    }

    @MODULE[ModuleEngines*]
    {
        @name = ModuleEnginesRF
        //thrustVectorTransformName = thrustTransform
        @minThrust = 3.1
        @maxThrust = 3.1
        @heatProduction = 100
        //fxOffset = 0, 0, 0.8
        %ullage = True
        %pressureFed = True
        %ignitions = -1

        @PROPELLANT[MonoPropellant]
        {
            @name = UDMH
            @ratio = 0.4977
        }

        PROPELLANT
        {
            name = NTO
            ratio = 0.5023
            DrawGauge = False
        }

        atmosphereCurve
        {
            key = 0 292
            key = 1 100
        }
    }

    @MODULE[ModuleRCS]:HAS[#thrusterTransformName[DPO_M]]
    {
        !enableRoll = NULL
        !enableYaw = NULL
        !enablePitch = NULL
        !enableX = NULL
        !enableY = NULL
        !enableZ = NULL
        !fxPrefix = NULL
        @thrusterPower = 0.0245
        !resourceName = NULL

        PROPELLANT
        {
            name = UDMH
            ratio = 0.4977
        }

        PROPELLANT
        {
            name = NTO
            ratio = 0.5023
        }

        @atmosphereCurve
        {
            @key,0 = 0 292
            @key,1 = 1 100
        }
    }

    @MODULE[ModuleRCS]:HAS[#thrusterTransformName[DPO_B]]
    {
        !enableRoll = NULL
        !enableYaw = NULL
        !enablePitch = NULL
        !enableX = NULL
        !enableY = NULL
        !enableZ = NULL
        !fxPrefix = NULL
        @thrusterPower = 0.137
        !resourceName = NULL

        PROPELLANT
        {
            name = UDMH
            ratio = 0.4977
        }

        PROPELLANT
        {
            name = NTO
            ratio = 0.5023
        }

        @atmosphereCurve
        {
            @key,0 = 0 292
            @key,1 = 1 100
        }
    }

    !MODULE[ModuleAlternator]{}

    !MODULE[ModuleFuelTanks]{}

    MODULE
    {
        name = ModuleFuelTanks
        type = ServiceModule
        volume = 895
        basemass = -1

        TANK
        {
            name = ElectricCharge
            amount = 93000
            maxAmount = 93000
        }

        //  KTDU-80 fuel 315 Kg.

        TANK
        {
            name = UDMH
            amount = 400
            maxAmount = 400
        }

        //  KTDU-80 oxidizer 583 Kg.

        TANK
        {
            name = NTO
            amount = 400
            maxAmount = 400
        }
    }

    MODULE
    {
        name = ModuleActiveRadiator
        maxEnergyTransfer = 5.0
        overcoolFactor = 1.0
        isCoreRadiator = True

        RESOURCE
        {
            name = ElectricCharge
            rate = 0.25
        }
    }

    !RESOURCE,*{}
}
