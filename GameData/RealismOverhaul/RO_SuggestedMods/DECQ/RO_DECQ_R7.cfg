//  ==================================================
//  Sources:

//  Soyuz User's Manual:         http://www.starsem.com/services/images/soyuz_users_manual_190401.pdf
//  Soyuz - Norbert Br√ºgge:      http://www.b14643.de/Spacerockets_1/East_Europe_1/Semyorka/Description/Soyuz/Frame.htm
//  Soyuz - Space Launch Report: http://spacelaunchreport.com/soyuz.html
//  Soyuz - Spaceflight 101:     http://spaceflight101.com/spacerockets/soyuz-fg/
//  RD-0110 - Russian Space Web: http://www.russianspaceweb.com/rd0110.html

//  ==================================================
//  Soyuz Block I stage.

//  Dimensions: - m
//  Inert Mass: - Kg
//  ==================================================

@PART[R7_BLOCK_I]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

	@category = FuelTank
	@title = Soyuz FG/U Block I
    %manufacturer = S. P. Korolev RSC Energia
	@description = The Block I third stage is the most commonly used upper stage for the R7 rocket. It can be fitted with either RD-0110 engine or the newer RD-0124. It has a special vent nozzle designed to put it into a tumble, so that it doesn't collide with the payload.

	@mass = 2.4
    @crashTolerance = 12
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 723.15
    %skinMaxTemp = 723.15
    %stageOffset = 1
    %childStageOffset = 1
    %fuelCrossFeed = True

	@MODULE[ModuleEngines*]
    {
		@minThrust = 2.5
		@maxThrust = 2.5
		@heatProduction = 100
		@useEngineResponseTime = False
		@engineAccelerationSpeed = 0
        //fxOffset = 0, 0, 0.35
        %ullage = False
        %pressureFed = False
        %ignitions = 1

		@PROPELLANT[Oxidizer]
        {
            @name = LqdOxygen
			@ratio = 1.0
			@DrawGauge = True
		}

        @atmosphereCurve
		{
			@key,0 = 0 85
			@key,1 = 1 30
		}
	}

    MODULE
    {
        name = ModuleFuelTanks
        type = Default
        volume = 22430
        basemass = -1

        //  RD-0110 fuel 7077 Kg.

        TANK
        {
            name = Kerosene
            amount = 8630
            maxAmount = 8630
        }

        //  RD-0110 oxidizer 15747 Kg.

        TANK
        {
            name = LqdOxygen
            amount = 13800
            maxAmount = 13800
        }
    }

    MODULE
    {
        name = ModuleCommand
        minimumCrew = 0

        RESOURCE
        {
            name = ElectricCharge
            rate = 0.15
        }
    }

    MODULE
    {
        name = ModuleSAS
        SASServiceLevel = 3
        standalone = True
    }

    !RESOURCE,*{}

    //  Avionics batteries 360 Wh.
    //  Supports the Block I stage for the duration of it's flight (approximately 10 minutes).

    RESOURCE
    {
        name = ElectricCharge
        amount = 100
        maxAmount = 100
    }
}

//  ==================================================
//  Soyuz Block I stage.

//  Remote Tech compatibility.
//  ==================================================

@PART[R7_BLOCK_I]:FOR[RealismOverhaul]:NEEDS[RemoteTech]
{
    @MODULE[ModuleCommand]
    {
        @RESOURCE[ElectricCharge]
        {
            @rate -= 0.025
        }
    }

    !MODULE[ModuleSPU*]{}

    !MODULE[ModuleRTAntenna*]{}

    MODULE
    {
        name = ModuleSPU
        IsRTCommandStation = False
        RTCommandMinCrew = 0
    }

    MODULE
    {
        name = ModuleRTAntenna
        IsRTActive = True
        Mode0OmniRange = 0
        Mode1OmniRange = 100000
        EnergyCost = 0.025

        TRANSMITTER
        {
            PacketInterval = 1.0
            PacketSize = 0.128
            PacketResourceCost = 0.01385
        }
    }
}

//  ==================================================
//  RD - 0110 engine.

//  Dimensions: - m
//  Inert Mass: 451 Kg
//  ==================================================

@PART[RD_0110]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @mass = 0.451
    @crashTolerance = 12
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 723.15
    %skinMaxTemp = 723.15
    %stageOffset = 1
    %childStageOffset = 1

    %engineType = RD0110
    %engineTypeMult = 1
    %massOffset = 0
    %ignoreMass = False

    @MODULE[ModuleEngines*],0
    {
        @name = ModuleEnginesRF
        @engineID = MainEngine
        //powerEffectName = engineFlame
        @minThrust = 269.69
        @maxThrust = 298
        @heatProduction = 100
        %ullage = True
        %pressureFed = False
        %ignitions = 1
    
        @PROPELLANT[LiquidFuel]
        {
            @name = Kerosene
            @ratio = 0.3853
        }

        @PROPELLANT[Oxidizer]
        {
            @name = LqdOxygen
            @ratio = 0.6147
            %DrawGauge = False
        }

        @atmosphereCurve
        {
            @key,0 = 0 326
            @key,1 = 1 141
        }
    }   

    @MODULE[ModuleEngines*],1
    {
        @name = ModuleEnginesRF
        %engineID = VernierEngine
        //powerEffectName = vernierFlame
        @minThrust = 10.0
        @maxThrust = 10.0
        @heatProduction = 100
        %ullage = True
        %pressureFed = False
        %ignitions = 1
    
        @PROPELLANT[LiquidFuel]
        {
            @name = Kerosene
            @ratio = 0.3853
        }

        @PROPELLANT[Oxidizer]
        {
            @name = LqdOxygen
            @ratio = 0.6147
            %DrawGauge = False
        }

        @atmosphereCurve
        {
            @key,0 = 0 326
            @key,1 = 1 141
        }
    }

    @MODULE[ModuleGimbal]
    {
        !gimbalRange = NULL
        %gimbalRangeYP = 7.0
        %gimbalRangeYN = 7.0
        %gimbalRangeXP = 7.0
        %gimbalRangeXN = 7.0
        @gimbalResponseSpeed = 16
    }   
}

//  ==================================================
//  Soyuz truss interstage adapter.

//  Dimensions: - m
//  Inert Mass: 400 Kg
//  ==================================================

@PART[DECOUPLER]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @title = Soyuz FG/U Truss Interstage Adapter
    %manufacturer = S. P. Korolev RSC Energia

    @mass = 0.4
    @crashTolerance = 12
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 523.15
    %skinMaxTemp = 523.15
    %stageOffset = 1
    %childStageOffset = 1
    !specPower = NULL

    @MODULE[ModuleDecouple]
    {
        @ejectionForce = 0
    }
}

//  ==================================================
//  Soyuz core booster.

//  Dimensions: - m
//  Gross Mass: - Kg

//  Inert mass does not include the mass of the truss
//  interstage adapter (400 Kg).
//  ==================================================

@PART[R7_SECOND_STAGE]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @mass = 6.1
    @crashTolerance = 12
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 523.15
    %skinMaxTemp = 523.15
    %stageOffset = 1
    %childStageOffset = 1
    %fuelCrossFeed = True
    !specPower = NULL

    %engineType = RD108-118
    %engineTypeMult = 1
    %massOffset = 4.82
    %ignoreMass = True

    @MODULE[ModuleEngines*],0
    {
        @name = ModuleEnginesRF
        %engineID = CoreMainEngine
        //powerEffectName = engineFlame
        @minThrust = 918.3
        @maxThrust = 918.3
        @heatProduction = 100
        %ullage = True
        %pressureFed = False
        %ignitions = 1
    
        @PROPELLANT[LiquidFuel]
        {
            @name = Kerosene
            @ratio = 0.3531
        }

        @PROPELLANT[Oxidizer]
        {
            @name = LqdOxygen
            @ratio = 0.6274
            %DrawGauge = False
        }

        PROPELLANT
        {
            name = HTP
            ratio = 0.0195
            DrawGauge = False
            ignoreForIsp = True
        }

        @atmosphereCurve
        {
            @key,0 = 0 308
            @key,1 = 1 241
        }
    }

    @MODULE[ModuleEngines*],1
    {
        @name = ModuleEnginesRF
        %engineID = CoreVernierEngine
        //powerEffectName = vernierFlame
        @minThrust = 20.0
        @maxThrust = 20.0
        @heatProduction = 100
        %ullage = True
        %pressureFed = False
        %ignitions = 1
    
        @PROPELLANT[LiquidFuel]
        {
            @name = Kerosene
            @ratio = 0.3531
        }

        @PROPELLANT[Oxidizer]
        {
            @name = LqdOxygen
            @ratio = 0.6274
            %DrawGauge = False
        }

        @atmosphereCurve
        {
            @key,0 = 0 308
            @key,1 = 1 241
        }
    }

    !MODULE[TRReflection],*{}

    MODULE
    {
        name = ModuleFuelTanks
        type = Default
        volume = 93755
        basemass = -1

        //  RD-108 fuel 25640 Kg.

        TANK
        {
            name = Kerosene
            amount = 31270
            maxAmount = 31270
        }

        //  RD-108 oxidizer 65360 Kg.

        TANK
        {
            name = LqdOxygen
            amount = 57280
            maxAmount = 57280
        }

        //  RD-108 turbopump fuel 2475 Kg.

        TANK
        {
            name = HTP
            amount = 1730
            maxAmount = 1730
        }
    }

    !RESOURCE,*{}
}

//  ==================================================
//  Soyuz core booster.

//  Engine compatibility.
//  ==================================================

@PART[R7_SECOND_STAGE]:FOR[RealismOverhaulEngines]
{
    @title = Soyuz FG/U Core Stage
    @manufacturer = S. P. Korolev RSC Energia
    @description = The Block A is one of the few parts that still remain mostly unchanged from the original R7 design. A very reliable element, powered by a single RD-108 engine with four verniers for attitude control. It is ignited on the ground along with the strap - on boosters.

    @MODULE[ModuleGimbal]
    {
        !gimbalRange = NULL
        %gimbalRangeYP = 4.5
        %gimbalRangeYN = 4.5
        %gimbalRangeXP = 4.5
        %gimbalRangeXN = 4.5
    }
}

//  ==================================================
//  Soyuz strap - on booster decoupler.

//  Dimensions: N/A
//  Inert Mass: 200 Kg
//  ==================================================

@PART[R7_FIRST_STAGE_DECOUPLER]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @title = Soyuz FG/U Booster Decoupler
    @manufacturer = S. P. Korolev RSC Energia

    @mass = 0.2
    @crashTolerance = 12
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 423.15
    %skinMaxTemp = 423.15

    @MODULE[ModuleDecouple]
    {
        @ejectionForce = 500
    }
}

//  ==================================================
//  Soyuz strap - on booster oxidizer valve.

//  Dimensions: - m
//  Gross Mass: 50 Kg
//  ==================================================

@PART[R7_FS_TOP]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

	@title = Soyuz FG/U Booster LOX Valve
    %manufacturer = S. P. Korolev RSC Energia
	@description = A small dump valve that allows venting of the liquid oxygen residue to aid in booster separation.

    @mass = 0.05
    @crashTolerance = 12
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 423.15
    %skinMaxTemp = 423.15
    %stageOffset = 1
    %childStageOffset = 1

    @MODULE[ModuleEngines*]
    {
        @name = ModuleEnginesRF
		//powerEffectName = running_closed
		@minThrust = 20.0
		@maxThrust = 20.0
		@heatProduction = 0
		@useEngineResponseTime = False
		@engineAccelerationSpeed = 0
		//fxOffset = 0, 0, 0.35
        %ullage = False
        %pressureFed = False
        %ignitions = 1

		@PROPELLANT[Oxidizer]
        {
            @name = LqdOxygen
            @ratio = 1.0
            %DrawGauge = True
        }

		@atmosphereCurve
		{
			@key,0 = 0 85
			@key,1 = 1 50
		}
	}
}

//  ==================================================
//  Soyuz strap - on booster.

//  Dimensions: - m
//  Gross Mass: - Kg

//  Inert mass does not include the mass of the radial
//  decoupler (200 Kg).
//  ==================================================

@PART[R7_FIRST_STAGE]:FOR[RealismOverhaul]
{
    %RSSROConfig = True

    @MODEL
    {
        @scale = 1.0, 1.0, 1.0
    }

    @scale = 1.0
    @rescaleFactor = 1.0

    @mass = 3.5
    @crashTolerance = 12
    @breakingForce = 250
    @breakingTorque = 250
    @maxTemp = 523.15
    %skinMaxTemp = 523.15
    %stageOffset = 1
    %childStageOffset = 1
    %fuelCrossFeed = True
    !specPower = NULL

    %engineType = RD107-117
    %engineTypeMult = 1
    %massOffset = 2.61
    %ignoreMass = True

    @MODULE[ModuleEngines*],0
    {
        @name = ModuleEnginesRF
        //powerEffectName = engineFlame
        %engineID = BoosterMainEngine
        @minThrust = 972.3
        @maxThrust = 972.3
        @heatProduction = 100
        %ullage = True
        %pressureFed = False
        %ignitions = 1

        @PROPELLANT[LiquidFuel]
        {
            @name = Kerosene
            @ratio = 0.3531
        }

        @PROPELLANT[Oxidizer]
        {
            @name = LqdOxygen
            @ratio = 0.6274
            %DrawGauge = False
        }

        PROPELLANT
        {
            name = HTP
            ratio = 0.0195
            DrawGauge = False
            ignoreForIsp = True
        }

        @atmosphereCurve
        {
            @key,0 = 0 308
            @key,1 = 1 250
        }
    } 

    @MODULE[ModuleEngines*],1
    {
        @name = ModuleEnginesRF
        %engineID = BoosterVernierEngine
        //powerEffectName = vernierFlame
        @minThrust = 20.0
        @maxThrust = 20.0
        @heatProduction = 100
        %ullage = True
        %pressureFed = False
        %ignitions = 1
    
        @PROPELLANT[LiquidFuel]
        {
            @name = Kerosene
            @ratio = 0.3531
        }

        @PROPELLANT[Oxidizer]
        {
            @name = LqdOxygen
            @ratio = 0.6274
            %DrawGauge = False
        }

        @atmosphereCurve
        {
            @key,0 = 0 308
            @key,1 = 1 250
        }
    }  

    @MODULE[ModuleLiftingSurface]
    {
        @deflectionLiftCoeff = 0.12     //0.42m^2
    }

    !MODULE[TRReflection],*{}

    MODULE
    {
        name = ModuleFuelTanks
        type = Default
        volume = 38920
        basemass = -1

        //  RD-107 fuel.

        TANK
        {
            name = Kerosene
            amount = 13470
            maxAmount = 13470
        }

        //  RD-107 oxidizer.

        TANK
        {
            name = LqdOxygen
            amount = 24700
            maxAmount = 24700
        }

        //  RD-107 turbopump fuel.

        TANK
        {
            name = HTP
            amount = 750
            maxAmount = 750
        }
    }

    !RESOURCE,*{}
}

//  ==================================================
//  Soyuz strap - on booster.

//  Engine compatibility.
//  ==================================================

@PART[R7_FIRST_STAGE]:FOR[RealismOverhaulEngines]
{
    @title = Soyuz FG/U Booster
    @manufacturer = S. P. Korolev RSC Energia
    @description = One of the oldest parts of the R7 launch vehicle series, the strap - on booster was designed to support the core stage both in flight and on the ground. The individual boosters are designated as Blocks B,V,G and D and it is powered by the RD-107 engine. It is ignited on the ground along with the second (core booster) stage.

    @MODULE[ModuleGimbal]
    {
        !gimbalRange = NULL
        @gimbalRangeYP = 0
        @gimbalRangeYN = 0
        @gimbalRangeXP = 1.5
        @gimbalRangeXN = 1.5
    }
}
